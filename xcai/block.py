# AUTOGENERATED! DO NOT EDIT! File to edit: ../nbs/03_block.ipynb.

# %% auto 0
__all__ = ['PARAM', 'CFGS', 'TFMS', 'wikiseealsotitles', 'wikiseealso', 'wikititles', 'amazontitles', 'XCBlock', 'prepare_batch']

# %% ../nbs/03_block.ipynb 2
import numpy as np, re, inspect
from typing import Optional, Dict
from transformers import AutoTokenizer, BatchEncoding

from fastcore.meta import *

from .data import *
from .transform import *

# %% ../nbs/03_block.ipynb 6
PARAM = {
    
    # collator arguements
    'tfm': 'xc', 
    'smp_features': [('lbl2data',1,2), ('hlk2data',1,1), ('hlk2lbl2data',2,1)],
    
    # arguements for Info class
    'info_column_names': ['identifier', 'input_text'], 
    'use_tokenizer': True, 
    'tokenizer': 'bert-base-cased',
    'tokenization_column': 'input_text',
    'max_sequence_length': 32,
    
    # PadFeatTfm arguements
    'pad_side': 'right',
    'drop': True,
    'ret_t': True,
    'in_place': True,
    'collapse': True,
    'device': 'cpu',
    
    # AlignInputIdsTfm arguements
    'inp': 'data',
    'targ': 'lbl2data',
    'ptr': 'lbl2data_data2ptr',
    
    # Data arguements
    'n_data_meta_samples': None,
    'n_lbl_meta_samples': None,
    'n_lbl_samples': None,
    
}

# %% ../nbs/03_block.ipynb 8
def wikiseealsotitles(data_dir):
    return {
        'train' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_train.txt',
                },
            },
            'parameters': PARAM,
        },
        'data' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_train.txt',
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_test.txt',
                },
            },
            'parameters': PARAM,
        },
        'train_meta' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_train.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/hyper_link_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/hyper_link.raw.txt'
                    },
                },
            },
            'parameters': PARAM,
        },
        'data_meta' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_train.txt',
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_test.txt',
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        }, 
        'data_metas' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_train.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/hyper_link_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/hyper_link.raw.txt'
                    },
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_test.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/hyper_link_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/hyper_link.raw.txt',
                    },
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        }, 
        'data_catlnk' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_train.txt',
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt'
                    },
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_renee_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_renee_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_test.txt',
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt',
                    },
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_renee_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_renee_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        },
        'data_linker' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_train.txt',
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_renee_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_renee_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/filter_labels_test.txt',
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_renee_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/category_renee_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiSeeAlsoTitles-320K/raw_data/category.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        }, 
    }

# %% ../nbs/03_block.ipynb 9
def wikiseealso(data_dir):
    return {
        'train' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_train.txt',
                },
            },
            'parameters': PARAM,
        },
        'data' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_train.txt',
                },
                'test': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_test.txt',
                },
            },
            'parameters': PARAM,
        },
        'train_meta' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_train.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/hyper_link_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/hyper_link.raw.txt'
                    },
                },
            },
            'parameters': PARAM,
        },
        'data_meta' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_train.txt',
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_test.txt',
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        }, 
        'data_metas' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_train.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/hyper_link_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/hyper_link.raw.txt'
                    },
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_test.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/hyper_link_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/hyper_link.raw.txt',
                    },
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        }, 
        'data_catlnk' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_train.txt',
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt'
                    },
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_renee_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_renee_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_test.txt',
                    'cat_meta': {
                        'prefix': 'cat',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt',
                    },
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_renee_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_renee_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        },
        'data_linker' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_train.txt',
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_renee_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_renee_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/LF-WikiSeeAlso-320K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/LF-WikiSeeAlso-320K/filter_labels_test.txt',
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_renee_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/LF-WikiSeeAlso-320K/category_renee_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/LF-WikiSeeAlso-320K/raw_data/category.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        }, 
    }

# %% ../nbs/03_block.ipynb 10
def wikititles(data_dir):
    return {
        'train' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                },
            },
            'parameters': PARAM,
        },
        'data' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                },
            },
            'parameters': PARAM,
        },
        'train_meta' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/hyper_link.raw.txt'
                    },
                },
            },
            'parameters': PARAM,
        },
        'data_meta' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                    'sal_meta': {
                        'prefix': 'sal',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/see_also_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/see_also_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/see_also.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                    'sal_meta': {
                        'prefix': 'sal',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/see_also_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/see_also_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/see_also.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        },
        'data_metas' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/hyper_link.raw.txt'
                    },
                    'sal_meta': {
                        'prefix': 'sal',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/see_also_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/see_also_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/see_also.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/hyper_link.raw.txt',
                    },
                    'sal_meta': {
                        'prefix': 'sal',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/see_also_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/see_also_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/see_also.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        },
        'data_hlklnk' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/hyper_link.raw.txt'
                    },
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_renee_mean_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_renee_mean_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/hyper_link.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-WikiTitles-500K/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/label.raw.txt',
                    'hlk_meta': {
                        'prefix': 'hlk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/hyper_link.raw.txt',
                    },
                    'lnk_meta': {
                        'prefix': 'lnk',
                        'data_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_renee_mean_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-WikiTitles-500K/hyper_link_renee_mean_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-WikiTitles-500K/raw_data/hyper_link.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        },
    }

# %% ../nbs/03_block.ipynb 12
def amazontitles(data_dir):
    return {
        'train' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/filter_labels_train.txt',
                },
            },
            'parameters': PARAM,
        },
        'data' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/filter_labels_train.txt',
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/filter_labels_test.txt',
                },
            },
            'parameters': PARAM,
        },
        'train_meta' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/filter_labels_train.txt',
                    'rel_meta': {
                        'prefix': 'rel',
                        'data_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/related_items.raw.txt'
                    },
                },
            },
            'parameters': PARAM,
        },
        'data_meta' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/filter_labels_train.txt',
                    'rel_meta': {
                        'prefix': 'rel',
                        'data_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/related_items.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/filter_labels_test.txt',
                    'rel_meta': {
                        'prefix': 'rel',
                        'data_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/related_items.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        },
        'data_metas' : {
            'path': {
                'train': {
                    'data_lbl': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/trn_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/train.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/filter_labels_train.txt',
                    'rel_meta': {
                        'prefix': 'rel',
                        'data_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/related_items.raw.txt'
                    },
                    'cat_meta': {
                        'prefix': 'rel',
                        'data_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/category_trn_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/category.raw.txt'
                    },
                },
                'test': {
                    'data_lbl': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/tst_X_Y.txt',
                    'data_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/test.raw.txt',
                    'lbl_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/label.raw.txt',
                    'data_lbl_filterer': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/filter_labels_test.txt',
                    'rel_meta': {
                        'prefix': 'rel',
                        'data_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/related_items_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/related_items.raw.txt',
                    },
                    'cat_meta': {
                        'prefix': 'rel',
                        'data_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/category_tst_X_Y.txt',
                        'lbl_meta': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/category_lbl_X_Y.txt',
                        'meta_info': f'{data_dir}/(mapped)LF-AmazonTitles-1.3M/raw_data/category.raw.txt',
                    },
                },
            },
            'parameters': PARAM,
        },
    }

# %% ../nbs/03_block.ipynb 14
CFGS = {'wikiseealsotitles':wikiseealsotitles, 'wikiseealso':wikiseealso, 'wikititles':wikititles, 'wikipedia':wikipedia, 'amazontitles':amazontitles}
TFMS = {
    'xc': [XCPadFeatTfm, AlignInputIdsTfm], 
    'ng': [NGPadFeatTfm], 
    'xcnlg': [XCSamplePadFeatTfm], 
    'rm':[RamenPadFeatTfm],
}

# %% ../nbs/03_block.ipynb 15
class XCBlock:

    @delegates(XCDataBlock.from_cfg)
    @classmethod
    def from_cfg(cls, data_dir:str, cfg:str, dset:Optional[str]='wikiseealsotitles', bsz:Optional[int]=10, **kwargs):
        if dset not in CFGS: raise ValueError(f'Invalid `dset`({dset})')
        cfgs = CFGS[dset](data_dir)

        if cfg not in cfgs: raise ValueError(f'Invalid `cfg`({cfg})')
        cfg = cfgs[cfg] 
            
        for k in cfg['parameters']: 
            if k in kwargs and kwargs[k] is not None: cfg['parameters'][k]=kwargs.pop(k)
                
        tokz = AutoTokenizer.from_pretrained(cfg['parameters']['tokenizer'])
        cfg['parameters']['sep_tok'] = tokz.sep_token_id 
        cfg['parameters']['pad_tok'] = tokz.pad_token_id
        cfg['parameters']['batch_size'] = bsz
        
        collator = XCCollator(TfmPipeline([o(**cfg['parameters']) for o in TFMS[cfg['parameters']['tfm']]]))
        
        return XCDataBlock.from_cfg(cfg, collate_fn=collator, **kwargs)


# %% ../nbs/03_block.ipynb 36
def prepare_batch(m, b, m_args=None):
    m_kwargs = inspect.signature(m.forward).parameters
    return BatchEncoding({k:v for k,v in b.items() if k in m_kwargs or (m_args is not None and k in m_args)})
